<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Evaluation of counterterms · FeynmanDiagram.jl</title><meta name="title" content="Evaluation of counterterms · FeynmanDiagram.jl"/><meta property="og:title" content="Evaluation of counterterms · FeynmanDiagram.jl"/><meta property="twitter:title" content="Evaluation of counterterms · FeynmanDiagram.jl"/><meta name="description" content="Documentation for FeynmanDiagram.jl."/><meta property="og:description" content="Documentation for FeynmanDiagram.jl."/><meta property="twitter:description" content="Documentation for FeynmanDiagram.jl."/><meta property="og:url" content="https://numericaleft.github.io/FeynmanDiagram.jl/manual/counterterms/"/><meta property="twitter:url" content="https://numericaleft.github.io/FeynmanDiagram.jl/manual/counterterms/"/><link rel="canonical" href="https://numericaleft.github.io/FeynmanDiagram.jl/manual/counterterms/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">FeynmanDiagram.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Evaluation of counterterms</a><ul class="internal"><li><a class="tocitem" href="#New-approach-to-counterterm-evaluation"><span>New approach to counterterm evaluation</span></a></li><li><a class="tocitem" href="#Evaluation-of-interaction-counterterms"><span>Evaluation of interaction counterterms</span></a></li><li><a class="tocitem" href="#Benchmark-of-counterterms-in-the-UEG"><span>Benchmark of counterterms in the UEG</span></a></li></ul></li><li><a class="tocitem" href="../feynman_rule/">Feynman Rules</a></li><li><a class="tocitem" href="../interaction/">Interaction/Scattering-Amplitude Convention</a></li><li><a class="tocitem" href="../hubbard_atom/">Hubbard Atom as a Test Case</a></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../lib/operator/">Quantum operator and its product</a></li><li><a class="tocitem" href="../../lib/computgraph/">Computational graph for general feynman diagrams</a></li><li><a class="tocitem" href="../../lib/taylorseries/">Taylor expansions in independent variables (support AbstractGraph)</a></li><li><a class="tocitem" href="../../lib/frontend/">Front-end generates Feynman diagrams and translates then into a computational graph</a></li><li><a class="tocitem" href="../../lib/GV/">GV expansion to a computational graph</a></li><li><a class="tocitem" href="../../lib/parquet/">Parquet Algorithm to Build Diagrams</a></li><li><a class="tocitem" href="../../lib/backend/">Compilers compile computational graphs to optimized source code for diverse platforms</a></li><li><a class="tocitem" href="../../lib/utility/">Utility</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Evaluation of counterterms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Evaluation of counterterms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/numericalEFT/FeynmanDiagram.jl/blob/master/docs/src/manual/counterterms.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Evaluation-of-counterterms"><a class="docs-heading-anchor" href="#Evaluation-of-counterterms">Evaluation of counterterms</a><a id="Evaluation-of-counterterms-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation-of-counterterms" title="Permalink"></a></h1><p>For illustrative simplicity, let us consider the renormalization of the chemical potential and Yukawa effective mass in the uniform electron gas (UEG). Following the Negele &amp; Orland conventions, the non-interacting Green&#39;s function <span>$g$</span> is given by</p><p class="math-container">\[ g(\mathbf{k}, i\omega_n) = -\frac{1}{i\omega_n-\epsilon_\mathbf{k} + \mu},\]</p><p>where <span>$G$</span> is the bold Green&#39;s function, <span>$\omega_n = 2\pi (n+1)/\beta$</span> is a fermionic Matsubara frequency, and <span>$\mu$</span> is the exact chemical potential derived from the interacting density <span>$n$</span>. The 1PI self-energy <span>$\Sigma$</span> is then defined through the following Dyson equation:</p><p class="math-container">\[ G^{-1} = g^{-1} + \Sigma \implies G = g - g\Sigma g + g\Sigma g \Sigma g - ...\;.\]</p><p>Following the variational diagrammatic Monte-Carlo (VDMC) approach, we rewrite the bare Green&#39;s function <span>$g$</span> in terms of a renormalized propagator <span>$g_R$</span>, writing</p><p class="math-container">\[ g(\mathbf{k}, i\omega_n) = -\frac{1}{i\omega_n-\epsilon_\mathbf{k} + \mu_R + \delta\mu}\]</p><p>where, motivated by Luttinger&#39;s theorem, the renormalized chemical potential <span>$\mu_R = \mu - \delta\mu \equiv \epsilon_F = k^2_F / 2 m$</span> is chosen so as to preserve the non-interacting Fermi surface, whereas <span>$\lambda$</span> is taken as a fixed, non-zero constant.</p><p>Similarly, the Coulomb interaction is re-written as</p><p class="math-container">\[ V(q) = \frac{e^2}{\epsilon_0 q^2} = \frac{e^2}{\epsilon_0} \frac{1}{q^2 + \lambda + \delta\lambda}.\]</p><p>We then work perturbatively in terms of the following renormalized Green&#39;s function and interaction,</p><p class="math-container">\[\begin{aligned}
 g_R(k, i\omega_n) &amp;\equiv -\frac{1}{i\omega_n-\epsilon_k + \mu_R} = g(k, i\omega_n) \Big|_{\delta\mu = 0},\\[2ex]
 V_\lambda(q) &amp;\equiv \frac{e^2}{\epsilon_0} \frac{1}{q^2 + \lambda} = V(q) \Big|_{\delta\lambda = 0}.
\end{aligned}\]</p><h2 id="New-approach-to-counterterm-evaluation"><a class="docs-heading-anchor" href="#New-approach-to-counterterm-evaluation">New approach to counterterm evaluation</a><a id="New-approach-to-counterterm-evaluation-1"></a><a class="docs-heading-anchor-permalink" href="#New-approach-to-counterterm-evaluation" title="Permalink"></a></h2><p>In the NEFT codebase, the counterterms are generated by directly differentiating diagrams in the perturbative series for a given observable, which allows for a flexible and generic reformulation of the VDMC algorithm. This is made possible by representing all diagrams by differentiable expression trees. In contrast, in the original VDMC approach one first Taylor expands all propagators <span>$g[g_R]$</span> and <span>$V[V_\lambda]$</span> entering a given observable by hand and collects terms in orders of <span>$\xi$</span> manually prior to integration.</p><p>The <span>$\mathcal{O}(\xi^N)$</span> counterterms in RPT with <span>$n$</span> and <span>$m$</span> chemical potential / interaction derivatives are given by</p><p class="math-container">\[ (\delta\mu)^n (\delta\lambda)^m \times \frac{1}{n! m!}\partial^n_{\mu} \partial^m_\lambda D_{N - n - m},\]</p><p>where <span>$D$</span> is the sum of all Feynman diagrams at the appropriate loop order <span>$N - n - m$</span>. The renormalization is performed in post-processing by multiplying with the Taylor series for <span>$(\delta\mu)^n (\delta\lambda)^m$</span> in <span>$\xi$</span> and collecting terms <span>$\propto \xi^N$</span>. The chemical potential shift <span>$\delta \mu_n$</span> is derived from a separate MC simulation of <span>$\Sigma^{\lambda_R}_F(k_F, ik_0)$</span>.</p><p>To demonstrate that the two approaches outlined above are equivalent, it is sufficient to consider separately the cases of <span>$V$</span> and <span>$g$</span> raised to an arbitrary power in the Matsubara representation; we will omit the coordinates for brevity.</p><p>First, consider the chemical potential counterterms. Let <span>$\delta\mu \equiv \mu_0 - \mu_R$</span>. Taylor expanding <span>$g[g_R]$</span> about <span>$\delta\mu = 0$</span>, we have</p><p class="math-container">\[ g = \frac{g_R}{1 - g_R\delta\mu} = g_R\sum^\infty_{n=0} (g_R\delta\mu)^n = \sum^\infty_{n=0} \frac{(\delta\mu)^n}{n!} \partial^n_\mu g_R,\]</p><p>since</p><p class="math-container">\[ g^{n+1}_R = \frac{1}{n!} \partial^n_\mu g_R.\]</p><p>Then,</p><p class="math-container">\[\begin{aligned}
 g^m &amp; = \left(\sum^\infty_{n=0} \frac{(\delta\mu)^n}{n!} \partial^n_\mu g_R\right)^m = g^m_R\left(1 - g_R\delta\mu\right)^{-m} = g^m_R \sum^\infty_{n=0} \binom{m+n-1}{n} (g_R\delta\mu)^{n}\\
     &amp; = \sum^\infty_{n=0} (\delta\mu)^{n} \frac{(m+n-1)!}{n! (m-1)!} g^{m+n}_R = \sum^\infty_{n=0} \frac{(\delta\mu)^{n}}{n! (m-1)!} \partial^{m+n-1}_\mu g_R = \sum^\infty_{n=0} \frac{(\delta\mu)^{n}}{n!} \partial^{n}_\mu g^m_R,
\end{aligned}\]</p><p>where in the last step, we replaced</p><p class="math-container">\[\begin{aligned}
 \frac{1}{(m-1)!} \partial^{m-1}_\mu g_R = g^m_R.
\end{aligned}\]</p><p>Thus, the series for <span>$g^m$</span> may be represented either by expanding each <span>$g[g_R]$</span> by hand and collecting terms, or by a direct Taylor expansion of <span>$g^m$</span> about <span>$\delta\mu = 0$</span>.</p><p>It remains to show that these two strategies are also equivalent for the expansion of <span>$V^m$</span>. Let <span>$\delta\lambda \equiv \lambda_0 - \lambda_R = -\lambda_R$</span> and Taylor expand <span>$V[V_\lambda]$</span> about <span>$\delta\lambda = 0$</span>—we obtain</p><p class="math-container">\[%
%  V = \frac{V_ \lambda}{1 - \frac{\lambda}{q^2 + \lambda}} = V_\lambda \sum_{n=0}^{\infty} \left(\frac{\lambda}{q^2 + \lambda}\right)^n = V_\lambda \sum_{n=0}^{\infty} \left(V_\lambda \delta\lambda\right)^n = \sum^\infty_{n=0} \frac{(-\lambda)^n}{n!} \partial^n_\lambda V_\lambda,
%\]</p><p class="math-container">\[ V = \frac{V_ \lambda}{1 - \delta_\lambda} = V_\lambda \sum_{n=0}^{\infty} \delta^n_\lambda = \sum^\infty_{n=0} \frac{(\delta\lambda)^n}{n!} \partial^n_\lambda V_\lambda\]</p><p>where</p><p class="math-container">\[ \delta_\lambda \equiv \frac{\lambda}{q^2 + \lambda},\]</p><p>since</p><p class="math-container">\[\begin{aligned}
 \frac{(\delta\lambda)^{n}}{n!} \partial^{n}_\lambda V_\lambda = 8\pi\frac{(-\lambda)^{n}}{n!} \partial^{n}_\lambda \left(\frac{1}{q^2 + \lambda}\right) = \frac{8\pi\lambda^n}{(q^2 + \lambda)^{n+1}} = V_\lambda \delta^n_\lambda.
\end{aligned}\]</p><p>We also have that</p><p class="math-container">\[\begin{aligned}
 \frac{(\delta\lambda)^n}{n!} \partial^{n}_\lambda V^m_\lambda = \left(\frac{\lambda}{8\pi}\right)^n \frac{m^{(n)}}{n!} V^{m+n}_\lambda = \binom{m + n - 1}{n} V^m_\lambda \delta^n_\lambda,
\end{aligned}\]</p><p>where <span>$m^{(n)} = \prod_{i=0}^{n-1} (m + i)$</span> is a rising factorial and</p><p class="math-container">\[ \binom{m + n - 1}{n} = \frac{(m + n - 1)!}{n! (m-1)!} = \frac{m^{(n)}}{n!}.\]</p><p>Thus,</p><p class="math-container">\[\begin{aligned}
 V^m &amp; = \left(\sum^\infty_{n=0} \frac{(\delta\lambda)^n}{n!} \partial^n_\lambda V_\lambda\right)^m = V^m_\lambda \left(1 - \delta_\lambda\right)^{-m} = \sum^\infty_{n=0} \binom{m+n-1}{n} V^m_\lambda \delta^n_\lambda = \sum^\infty_{n=0} \frac{(\delta\lambda)^{n}}{n!} \partial^{n}_\lambda V^m_\lambda.
\end{aligned}\]</p><p>Since the order of differentiation w.r.t. <span>$\mu$</span> and <span>$\lambda$</span> does not matter, it follows that a general diagram <span>$\mathcal{D}[g, V] \sim g^n V^m$</span> may be represented either by pre-expanding <span>$g[g_\mu]$</span> and <span>$V[V_\lambda]$</span> and collecting terms, or by directly evaluating terms in the Taylor series for <span>$\mathcal{D}[g_\mu, V_\lambda]$</span>; this codebase uses the latter approach.</p><h2 id="Evaluation-of-interaction-counterterms"><a class="docs-heading-anchor" href="#Evaluation-of-interaction-counterterms">Evaluation of interaction counterterms</a><a id="Evaluation-of-interaction-counterterms-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation-of-interaction-counterterms" title="Permalink"></a></h2><p>An example of the interaction counterterm evaluation for a diagram with <span>$n_\lambda = 3$</span> and <span>$m$</span> interaction lines. Since the Julia implementation evaluates the interaction counterterms of a given diagram as <span>$\frac{(-\lambda)^n}{n!}\partial^n_\lambda V^m_\lambda$</span>, we pick up an extra factor of <span>$l!$</span> on each <span>$l$</span>th-order derivative in the chain rule.</p><p><img src="../../assets/derivative_example.svg" alt="An example of the representation of interaction counterterm diagrams via differentiation."/></p><h2 id="Benchmark-of-counterterms-in-the-UEG"><a class="docs-heading-anchor" href="#Benchmark-of-counterterms-in-the-UEG">Benchmark of counterterms in the UEG</a><a id="Benchmark-of-counterterms-in-the-UEG-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-of-counterterms-in-the-UEG" title="Permalink"></a></h2><p>As a concrete example, we have evaluated the individual diagrams and associated counterterms entering the RPT series for the total density <span>$n[g_\mu, V_\lambda]$</span> in units of the non-interacting density <span>$n_0$</span>. The diagrams/counterterms are denoted by partitions <span>$\mathcal{P} \equiv (n_{\text{loop}}, n_\mu, n_\lambda)$</span> indicating the total loop order and number of <span>$\mu$</span> and <span>$\lambda$</span> derivatives.</p><h3 id="3D-UEG"><a class="docs-heading-anchor" href="#3D-UEG">3D UEG</a><a id="3D-UEG-1"></a><a class="docs-heading-anchor-permalink" href="#3D-UEG" title="Permalink"></a></h3><p>For this benchmark, we take <span>$r_s = 1$</span>, <span>$\beta = 40 \epsilon_F$</span>, and <span>$\lambda = 0.6$</span>. All partitions contributing up to 4th order are included, as well as some selected partitions at 5th and 6th order.</p><table><tr><th style="text-align: center"><span>$(n_{\text{loop}}, n_\lambda, n_\mu)$</span></th><th style="text-align: center"><span>$n / n_0$</span></th></tr><tr><td style="text-align: center">(1, 0, 1)</td><td style="text-align: center">0.40814(16)</td></tr><tr><td style="text-align: center">(1, 0, 2)</td><td style="text-align: center">0.02778(21)</td></tr><tr><td style="text-align: center">(1, 0, 3)</td><td style="text-align: center">-0.00096(60)</td></tr><tr><td style="text-align: center">(2, 0, 0)</td><td style="text-align: center">0.28853(12)</td></tr><tr><td style="text-align: center">(2, 1, 0)</td><td style="text-align: center">0.07225(3)</td></tr><tr><td style="text-align: center">(2, 2, 0)</td><td style="text-align: center">0.02965(2)</td></tr><tr><td style="text-align: center">(2, 0, 1)</td><td style="text-align: center">0.09774(30)</td></tr><tr><td style="text-align: center">(2, 1, 1)</td><td style="text-align: center">0.01594(10)</td></tr><tr><td style="text-align: center">(2, 0, 2)</td><td style="text-align: center">0.00240(130)</td></tr><tr><td style="text-align: center">(3, 0, 0)</td><td style="text-align: center">0.10027(37)</td></tr><tr><td style="text-align: center">(3, 1, 0)</td><td style="text-align: center">0.04251(21)</td></tr><tr><td style="text-align: center">(3, 0, 1)</td><td style="text-align: center">0.02600(150)</td></tr><tr><td style="text-align: center">(4, 0, 0)</td><td style="text-align: center">0.00320(130)</td></tr><tr><td style="text-align: center">(2, 1, 2)</td><td style="text-align: center">-0.00111(18)</td></tr><tr><td style="text-align: center">(2, 0, 3)</td><td style="text-align: center">-0.00430(150)</td></tr><tr><td style="text-align: center">(3, 2, 0)</td><td style="text-align: center">0.02241(8)</td></tr><tr><td style="text-align: center">(3, 3, 0)</td><td style="text-align: center">0.01429(7)</td></tr></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../feynman_rule/">Feynman Rules »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 1 November 2024 03:18">Friday 1 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
